{"version":3,"sources":["../index.ts","../src/git.ts"],"sourcesContent":["import 'dotenv/config';\nimport fs from 'node:fs';\nimport path from 'node:path';\nimport Enquirer from 'enquirer';\nimport OpenAI from 'openai';\nimport { getGitState } from './src/git';\n\nexport const systemPrompt = 'You are Commit-Whisperer, a genius at writing useful commit messages. Write a commit message that perfectly summarizes all important points based on the information provided by the user. The user may provide a git diff, instructions, or other details to help you craft the perfect message. If nothing is provided, or it appears to be a first commit, respond with a first commit message with a humorous tone.';\n\nexport const defaults = {\n  temperature: 0.8,\n  max_tokens: 1000,\n  model: 'gpt-4o',\n  stream: false\n};\n\nconst getPromptMessage = async optionsMessage => {\n  if (optionsMessage != null) {\n    return optionsMessage;\n  }\n\n  const enquirer = new Enquirer();\n  const { message } = await enquirer.prompt({\n    type: 'input',\n    name: 'message',\n    message: 'Enter instructions for the commit message (optional)'\n  });\n\n  return message;\n};\n\nconst formatContent = ({\n  gitState,\n  includeGitDiff,\n  message,\n  pkg\n}: {\n  gitState: any;\n  includeGitDiff: any;\n  message: string;\n  pkg: any;\n}) => {\n  const lines = [];\n\n  if (message) {\n    lines.push(`Instructions: ${message}`);\n    lines.push('');\n  }\n\n  if (pkg) {\n    lines.push('**Package details**');\n    lines.push(`- Name: ${pkg.name}`);\n    lines.push(`- Version: ${pkg.version}`);\n    lines.push(`- Description: ${pkg.description}`);\n    lines.push('');\n  }\n\n  if (gitState) {\n    lines.push(`**Git status**:\\n${gitState.status}`);\n    lines.push('');\n\n    if (includeGitDiff) {\n      lines.push(`**Git diff**:\\n${gitState.diff}`);\n      lines.push('');\n    }\n  }\n\n  return lines.join('\\n');\n};\n\nexport const whisper = async ({\n  cwd = process.cwd(),\n  useGitState = true,\n  usePackageJson = true,\n  message: optionsMessage,\n  instructions,\n  includeGitDiff = false,\n  orgId = process.env.OPENAI_ORG_ID,\n  apiKey = process.env.OPENAI_API_KEY,\n  openaiConfig = {},\n  ...options\n}: {\n  useGitState?: boolean;\n  orgId?: string;\n  apiKey?: string;\n  model?: string;\n} = {}) => {\n  const message = await getPromptMessage(optionsMessage);\n  const gitState = useGitState ? await getGitState(cwd) : null;\n  const pkgPath = path.resolve(cwd, 'package.json');\n  const pkg = usePackageJson && fs.existsSync(pkgPath)\n    ? JSON.parse(fs.readFileSync(pkgPath, 'utf8'))\n    : null;\n\n  const openai = new OpenAI({ apiKey, orgId });\n  const format = options.formatContent || formatContent;\n\n  const config = {\n    ...defaults,\n    ...openaiConfig\n  };\n\n  const response = await openai.chat.completions.create({\n    messages: [\n      { role: 'system', content: instructions || systemPrompt },\n      { role: 'user', content: format({ gitState, message, pkg, includeGitDiff }) }\n    ],\n    ...config\n  });\n\n  return response;\n};\n","import { execSync } from 'child_process';\n\nexport const getGitState = (cwd = process.cwd()) => {\n  try {\n    const status = execSync('git status --porcelain', { cwd }).toString().trim();\n    const diff = execSync('git diff', { cwd }).toString().trim();\n\n    return {\n      status,\n      diff\n    };\n  } catch (error) {\n    throw new Error('Failed to get git state: ' + error.message);\n  }\n};\n"],"mappings":"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","names":["Enquirer","path","fs","OpenAI"]}